<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Trap Tracker ‚Äî Aamr Benbrahim</title>
<style>
:root{
--bg:#0b0c10; --card:#12141a; --muted:#9aa3b2; --text:#eef2ff; --border:#232735;
--green:#22c55e; --red:#ef4444; --orange:#f97316; --yellow:#eab308;
--shadow: 0 10px 30px rgba(0,0,0,.35);
}
*{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;
background:linear-gradient(180deg,#090a0f,#0b0c10); color:var(--text)}
.wrap{max-width:1080px;margin:0 auto;padding:14px}
h1{margin:6px 0 2px;font-size:20px}
.sub{color:var(--muted);font-size:13px;margin:0 0 12px}
.grid{display:grid;gap:12px}
@media(min-width:980px){ .grid{grid-template-columns: 1.25fr .95fr} }

.card{background:rgba(18,20,26,.92);border:1px solid var(--border);border-radius:18px;padding:12px;box-shadow:var(--shadow)}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
label{font-size:12px;color:var(--muted);display:block;margin:0 0 6px}
input, textarea, select{
width:100%; padding:10px 12px; border-radius:14px; border:1px solid var(--border);
background:#0f1118; color:var(--text); outline:none;
}
textarea{min-height:74px; resize:vertical}

.btn{
border:1px solid var(--border); background:#0f1118; color:var(--text);
padding:10px 12px; border-radius:16px; font-weight:900;
display:inline-flex; align-items:center; justify-content:center; gap:8px;
}
.btn:active{transform:scale(.99)}
.btn.primary{background:#1b2030;border-color:#2a3150}
.btn.danger{background:#2a1212;border-color:#4b1f1f}
.btn.mini{padding:8px 10px;border-radius:14px;font-weight:900;font-size:12px}

.divider{height:1px;background:var(--border);margin:12px 0}
.small{font-size:12px;color:var(--muted)}
.hint{font-size:11px;color:var(--muted)}

.statgrid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}
.stat{border:1px solid var(--border);border-radius:16px;padding:10px;background:#0f1118}
.stat .k{font-size:11px;color:var(--muted)}
.stat .v{font-size:18px;font-weight:950;margin-top:3px}
.stat .s{font-size:11px;color:var(--muted);margin-top:3px}

/* segmented toggle */
.seg{
display:inline-flex;
border:1px solid var(--border);
background:#0f1118;
border-radius:16px;
overflow:hidden;
}
.seg button{
border:0;
background:transparent;
color:var(--muted);
padding:10px 12px;
font-weight:950;
font-size:12px;
min-width:90px;
}
.seg button.active{
background:#1b2030;
color:var(--text);
}

/* Simple mode big tap buttons */
.tapGrid{display:grid;grid-template-columns:1fr 1fr; gap:10px}
.tap{
padding:18px 14px; border-radius:18px; border:1px solid var(--border);
font-size:18px; font-weight:950;
box-shadow: 0 8px 20px rgba(0,0,0,.25);
min-height:64px;
}
.tap small{display:block; font-size:12px; font-weight:800; opacity:.85; margin-top:4px}
.tap.hit{background:rgba(34,197,94,.14); border-color:rgba(34,197,94,.35)}
.tap.left{background:rgba(239,68,68,.12); border-color:rgba(239,68,68,.28)}
.tap.center{background:rgba(249,115,22,.12); border-color:rgba(249,115,22,.30)}
.tap.right{background:rgba(234,179,8,.12); border-color:rgba(234,179,8,.30)}

/* 25-shot grid */
.shotsWrap{margin-top:10px}
.shotGrid{
display:grid;
grid-template-columns:repeat(5, 1fr);
gap:8px;
}
.shot{
border:1px solid var(--border);
border-radius:14px;
padding:10px 8px;
background:#0f1118;
text-align:center;
font-weight:950;
min-height:50px;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
}
.shot .meta{font-size:10px;font-weight:800;color:var(--muted);margin-top:3px}
.shot.hit{background:rgba(34,197,94,.10); border-color:rgba(34,197,94,.30); color:var(--green)}
.shot.miss{background:rgba(239,68,68,.08); border-color:rgba(239,68,68,.22); color:var(--red)}
.shot.pending{opacity:.55}
.shot .tiny{font-size:11px;font-weight:950}

/* badges */
.badge{
display:inline-flex;align-items:center;gap:8px;
border:1px solid var(--border); border-radius:999px; padding:6px 10px;
background:#0f1118; font-size:12px; font-weight:900;
}
.badge strong{font-weight:950}
.dot{width:10px;height:10px;border-radius:999px}

/* Best/Worst pills */
.pillScore{
display:inline-flex;align-items:center;gap:6px;
padding:6px 10px;border-radius:999px;border:1px solid var(--border);
background:#0f1118;font-size:12px;font-weight:950;
margin-right:6px;
white-space:nowrap;
}
.pillScore.good{border-color:rgba(34,197,94,.35); color:var(--green)}
.pillScore.mid{border-color:rgba(249,115,22,.35); color:var(--orange)}
.pillScore.low{border-color:rgba(239,68,68,.35); color:var(--red)}

/* filters */
.filters{display:grid;gap:10px}
@media(min-width:760px){ .filters{grid-template-columns: 1.2fr 1fr 1fr 1fr} }

/* saved list */
.list{display:grid;grid-template-columns:1fr;gap:10px}
@media(min-width:560px){ .list{grid-template-columns:1fr 1fr} }

.round{border:1px solid var(--border);border-radius:18px;overflow:hidden;background:#0f1118}
.roundHead{padding:12px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
.meta2{font-size:12px;color:var(--muted)}
.mini{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;padding:12px}
.box{border:1px solid var(--border);border-radius:16px;padding:10px}
.box .k{font-size:11px;color:var(--muted)}
.box .v{font-size:18px;font-weight:950;margin-top:4px}
.g{background:rgba(34,197,94,.08)} .rr{background:rgba(239,68,68,.08)}
.oo{background:rgba(249,115,22,.08)} .yy{background:rgba(234,179,8,.08)}
.notes{padding:12px;color:#d7def0;font-size:13px;white-space:pre-wrap}

/* Pro diagram */
.proWrap{display:grid;gap:10px;margin-top:8px}
.proOutcome{
display:grid;grid-template-columns:1fr 1fr;gap:10px;width:100%;
}
.outBtn{
border:1px solid var(--border);
border-radius:18px;
padding:18px 14px;
font-size:18px;
font-weight:950;
background:#0f1118;
min-height:64px;
box-shadow:0 8px 20px rgba(0,0,0,.22);
}
.outBtn.hit{border-color:rgba(34,197,94,.35); background:rgba(34,197,94,.12)}
.outBtn.miss{border-color:rgba(239,68,68,.35); background:rgba(239,68,68,.10)}
.outBtn.active{outline:2px solid rgba(238,242,255,.15)}

.diagramCard{
border:1px solid var(--border);
border-radius:18px;
padding:10px;
background:#0f1118;
}
.diagramTitle{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.diagramTitle .t{font-weight:950}
.diagramTitle .subt{font-size:12px;color:var(--muted)}
.diagramCard.dim{opacity:.45}
.zoneHint{font-size:11px;color:var(--muted);margin-top:6px}

/* SVG tap fix (IMPORTANT for iPhone) */
.zone{cursor:pointer}
.zone *{pointer-events:none} /* let the <g class="zone"> receive the tap */

/* tiny bars */
.bars{display:grid;gap:8px;margin-top:10px}
.barRow{display:grid;grid-template-columns:52px 1fr 56px;gap:8px;align-items:center}
.barTrack{height:10px;border-radius:999px;background:#0b0c10;border:1px solid var(--border);overflow:hidden}
.barFill{height:100%}
</style>
</head>
<body>
<div class="wrap">
<h1>Trap Tracker ‚Äî Aamr Benbrahim</h1>
<p class="sub">Live ISSF round logging. Simple mode (fast) or Pro mode (HL/SL/C/SR/HR + 1st/2nd shot). Data stays on your iPhone (local storage).</p>

<div class="grid">
<!-- LIVE ROUND -->
<div class="card">
<div class="row" style="justify-content:space-between">
<div>
<div style="font-weight:950;font-size:16px">Live Round Mode</div>
<div class="small" id="statusLine">Ready.</div>
</div>
<div class="row" style="gap:8px">
<button class="btn" id="undoBtn" type="button">‚Ü©Ô∏é Undo</button>
<button class="btn danger" id="resetRoundBtn" type="button">Reset round</button>
</div>
</div>

<div class="divider"></div>

<div class="row" style="justify-content:space-between">
<div class="seg" role="tablist" aria-label="Mode selector">
<button id="modeSimpleBtn" class="active" type="button">Simple</button>
<button id="modeProBtn" type="button">Pro</button>
</div>

<div class="seg" role="tablist" aria-label="Shot selector" id="shotSeg">
<button id="shot1Btn" class="active" type="button">1st shot</button>
<button id="shot2Btn" type="button">2nd shot</button>
</div>
</div>
<div class="hint" style="margin-top:6px" id="modeHint">Simple: HIT / MISS L / MISS C / MISS R.</div>

<div class="divider"></div>

<div class="statgrid">
<div class="stat"><div class="k">Station</div><div class="v" id="stationV">1/5</div></div>
<div class="stat"><div class="k">Shot</div><div class="v" id="shotV">0/25</div></div>
<div class="stat"><div class="k">Score</div><div class="v" id="scoreV">0/25</div></div>
<div class="stat"><div class="k">Hit %</div><div class="v" id="hitPctV">0%</div></div>
</div>

<!-- SIMPLE CONTROLS -->
<div id="simpleControls">
<div class="divider"></div>

<div class="tapGrid">
<button class="btn tap hit" id="tapHit" type="button">‚úÖ HIT<small>Green</small></button>
<button class="btn tap left" id="tapLeft" type="button">‚ùå MISS LEFT<small>Red</small></button>
<button class="btn tap center" id="tapCenter" type="button">‚ùå MISS CENTER<small>Orange</small></button>
<button class="btn tap right" id="tapRight" type="button">‚ùå MISS RIGHT<small>Yellow</small></button>
</div>
</div>

<!-- PRO CONTROLS -->
<div id="proControls" style="display:none">
<div class="divider"></div>

<div class="proWrap">
<div class="proOutcome">
<button class="outBtn hit active" id="proHitBtn" type="button">‚úÖ HIT</button>
<button class="outBtn miss" id="proMissBtn" type="button">‚ùå MISS</button>
</div>

<div class="small">Tap a zone on the diagram to record the next target.</div>

<div class="diagramCard" id="hitDiagramCard">
<div class="diagramTitle">
<div class="t">HIT zones</div>
<div class="subt">green</div>
</div>

<svg id="hitDiagram" viewBox="0 0 360 160" width="100%" height="160" style="display:block">
<line x1="180" y1="135" x2="70" y2="25" stroke="var(--green)" stroke-width="6" stroke-linecap="round" opacity="0.9"/>
<line x1="180" y1="135" x2="115" y2="25" stroke="var(--green)" stroke-width="6" stroke-linecap="round" opacity="0.9"/>
<line x1="180" y1="135" x2="180" y2="18" stroke="var(--green)" stroke-width="6" stroke-linecap="round" opacity="0.9"/>
<line x1="180" y1="135" x2="245" y2="25" stroke="var(--green)" stroke-width="6" stroke-linecap="round" opacity="0.9"/>
<line x1="180" y1="135" x2="290" y2="25" stroke="var(--green)" stroke-width="6" stroke-linecap="round" opacity="0.9"/>
<circle cx="180" cy="135" r="9" fill="#0f1118" stroke="var(--border)" stroke-width="2"/>

<g font-family="system-ui, -apple-system, Segoe UI" font-weight="900" font-size="12" fill="var(--text)">
<g class="zone" data-zone="HL">
<circle cx="70" cy="25" r="18" fill="rgba(34,197,94,.18)" stroke="rgba(34,197,94,.45)" stroke-width="2"/>
<text x="70" y="29" text-anchor="middle">HL</text>
</g>
<g class="zone" data-zone="SL">
<circle cx="115" cy="25" r="18" fill="rgba(34,197,94,.18)" stroke="rgba(34,197,94,.45)" stroke-width="2"/>
<text x="115" y="29" text-anchor="middle">SL</text>
</g>
<g class="zone" data-zone="C">
<circle cx="180" cy="18" r="18" fill="rgba(34,197,94,.18)" stroke="rgba(34,197,94,.45)" stroke-width="2"/>
<text x="180" y="22" text-anchor="middle">C</text>
</g>
<g class="zone" data-zone="SR">
<circle cx="245" cy="25" r="18" fill="rgba(34,197,94,.18)" stroke="rgba(34,197,94,.45)" stroke-width="2"/>
<text x="245" y="29" text-anchor="middle">SR</text>
</g>
<g class="zone" data-zone="HR">
<circle cx="290" cy="25" r="18" fill="rgba(34,197,94,.18)" stroke="rgba(34,197,94,.45)" stroke-width="2"/>
<text x="290" y="29" text-anchor="middle">HR</text>
</g>
</g>
</svg>

<div class="zoneHint">HL = Hard Left (60¬∞) ‚Ä¢ SL = Soft Left (30¬∞) ‚Ä¢ C = Center ‚Ä¢ SR = Soft Right ‚Ä¢ HR = Hard Right</div>
</div>

<div class="diagramCard dim" id="missDiagramCard">
<div class="diagramTitle">
<div class="t">MISS zones</div>
<div class="subt">red</div>
</div>

<svg id="missDiagram" viewBox="0 0 360 160" width="100%" height="160" style="display:block">
<line x1="180" y1="135" x2="70" y2="25" stroke="var(--red)" stroke-width="6" stroke-linecap="round" opacity="0.85"/>
<line x1="180" y1="135" x2="115" y2="25" stroke="var(--red)" stroke-width="6" stroke-linecap="round" opacity="0.85"/>
<line x1="180" y1="135" x2="180" y2="18" stroke="var(--red)" stroke-width="6" stroke-linecap="round" opacity="0.85"/>
<line x1="180" y1="135" x2="245" y2="25" stroke="var(--red)" stroke-width="6" stroke-linecap="round" opacity="0.85"/>
<line x1="180" y1="135" x2="290" y2="25" stroke="var(--red)" stroke-width="6" stroke-linecap="round" opacity="0.85"/>
<circle cx="180" cy="135" r="9" fill="#0f1118" stroke="var(--border)" stroke-width="2"/>

<g font-family="system-ui, -apple-system, Segoe UI" font-weight="900" font-size="12" fill="var(--text)">
<g class="zone" data-zone="HL">
<circle cx="70" cy="25" r="18" fill="rgba(239,68,68,.16)" stroke="rgba(239,68,68,.45)" stroke-width="2"/>
<text x="70" y="29" text-anchor="middle">HL</text>
</g>
<g class="zone" data-zone="SL">
<circle cx="115" cy="25" r="18" fill="rgba(239,68,68,.16)" stroke="rgba(239,68,68,.45)" stroke-width="2"/>
<text x="115" y="29" text-anchor="middle">SL</text>
</g>
<g class="zone" data-zone="C">
<circle cx="180" cy="18" r="18" fill="rgba(239,68,68,.16)" stroke="rgba(239,68,68,.45)" stroke-width="2"/>
<text x="180" y="22" text-anchor="middle">C</text>
</g>
<g class="zone" data-zone="SR">
<circle cx="245" cy="25" r="18" fill="rgba(239,68,68,.16)" stroke="rgba(239,68,68,.45)" stroke-width="2"/>
<text x="245" y="29" text-anchor="middle">SR</text>
</g>
<g class="zone" data-zone="HR">
<circle cx="290" cy="25" r="18" fill="rgba(239,68,68,.16)" stroke="rgba(239,68,68,.45)" stroke-width="2"/>
<text x="290" y="29" text-anchor="middle">HR</text>
</g>
</g>
</svg>

<div class="zoneHint">Tap the red diagram to record a miss zone.</div>
</div>
</div>
</div>
</div>

<!-- GRID -->
<div class="shotsWrap">
<div class="divider"></div>
<div class="row" style="justify-content:space-between">
<div class="small">25-shot grid (5 stations √ó 5).</div>
<div class="small">Pro cells show: ‚úÖ/‚ùå + zone + (1/2).</div>
</div>
<div class="shotGrid" id="shotGrid" style="margin-top:10px"></div>
</div>

<!-- META -->
<div class="divider"></div>

<div class="row">
<div style="flex:1;min-width:160px">
<label>Date</label>
<input id="date" type="date" />
</div>
<div style="flex:1;min-width:160px">
<label>Club (optional)</label>
<input id="club" placeholder="e.g. Rabat Shooting Club" />
</div>
<div style="flex:1;min-width:160px">
<label>Field (optional)</label>
<input id="field" placeholder="e.g. Field 2" />
</div>
</div>

<div class="row">
<div style="flex:1;min-width:160px">
<label>Notes (optional)</label>
<textarea id="notes" placeholder="Wind, light, ammo, focus cue, what felt off..."></textarea>
</div>
</div>

<div class="row" style="justify-content:space-between; margin-top:8px">
<div class="small">Finish 25/25 then save.</div>
<button class="btn primary" id="saveRoundBtn" type="button">Save round</button>
</div>
</div>

<!-- OVERVIEW -->
<div class="card">
<div style="font-weight:950;font-size:16px">Overview</div>
<div class="small" id="overviewSubtitle">Stats for the selected period</div>

<div class="divider"></div>

<div class="filters">
<div>
<label>Time range</label>
<select id="rangeSel">
<option value="today">Today</option>
<option value="week">This week</option>
<option value="month">This month</option>
<option value="last3">Last 3 months</option>
<option value="last6">Last 6 months</option>
<option value="year">This year</option>
<option value="all">All time</option>
<option value="monthPick">Past month‚Ä¶</option>
</select>
<div class="hint">Pick ‚ÄúPast month‚Ä¶‚Äù to choose any month.</div>
</div>

<div>
<label>Past months</label>
<select id="monthSel" disabled>
<option value="">Select month‚Ä¶</option>
</select>
<div class="hint">Only active when ‚ÄúPast month‚Ä¶‚Äù is selected.</div>
</div>

<div>
<label>Club (optional)</label>
<select id="clubSel">
<option value="all">All clubs</option>
</select>
</div>

<div>
<label>Field (optional)</label>
<select id="fieldSel">
<option value="all">All fields</option>
</select>
</div>
</div>

<div class="divider"></div>

<div class="row" style="justify-content:space-between; gap:10px">
<div class="row" style="gap:10px; flex-wrap:wrap">
<span class="badge" id="mostMissedBadge" style="display:none"></span>
<span class="badge" id="insightBadge" style="display:none"></span>
</div>
<div class="small" id="rangeCount">0 rounds</div>
</div>

<div style="height:10px"></div>

<!-- Top 3 stats -->
<div class="statgrid" style="grid-template-columns:repeat(3,minmax(0,1fr))">
<div class="stat">
<div class="k">Average</div>
<div class="v" id="avgHits">0.0/25</div>
<div class="s" id="avgHitsSub">Avg hit %: 0%</div>
</div>

<div class="stat">
<div class="k">Best / Worst</div>
<div class="v" id="bestWorst">‚Äî</div>
<div class="s" id="bestWorstSub">Colors: ‚â•20 green ‚Ä¢ 18‚Äì19 orange ‚Ä¢ <18 red ‚Ä¢ ‚≠ê ‚â•23</div>
</div>

<div class="stat">
<div class="k">Last 10 rounds</div>
<div class="v" id="last10">‚Äî</div>
<div class="s" id="last10Sub">Avg hits (if ‚â•10)</div>
</div>
</div>

<!-- Simple miss diagram (L/C/R avg per round) -->
<div class="divider"></div>
<div class="stat">
<div class="k">Average misses per round (Simple view)</div>
<div class="row" style="justify-content:space-between; align-items:flex-start; gap:12px; margin-top:6px">
<div style="flex:1;text-align:center">
<div style="font-weight:950;color:var(--red);font-size:18px" id="avgML">0.0</div>
<div class="small">LEFT</div>
</div>
<div style="flex:1;text-align:center">
<div style="font-weight:950;color:var(--orange);font-size:18px" id="avgMC">0.0</div>
<div class="small">CENTER</div>
</div>
<div style="flex:1;text-align:center">
<div style="font-weight:950;color:var(--yellow);font-size:18px" id="avgMR">0.0</div>
<div class="small">RIGHT</div>
</div>
</div>

<svg viewBox="0 0 320 90" width="100%" height="90" style="margin-top:8px">
<path d="M160 80 C120 60, 90 40, 60 18" fill="none" stroke="var(--red)" stroke-width="6" stroke-linecap="round"/>
<path d="M160 80 C160 58, 160 40, 160 16" fill="none" stroke="var(--orange)" stroke-width="6" stroke-linecap="round"/>
<path d="M160 80 C200 60, 230 40, 260 18" fill="none" stroke="var(--yellow)" stroke-width="6" stroke-linecap="round"/>
<circle cx="160" cy="80" r="7" fill="#0f1118" stroke="var(--border)" stroke-width="2"/>
</svg>

<div class="s" id="missDiagramSub">Based on selected period</div>
</div>

<!-- PRO INSIGHTS -->
<div class="divider"></div>
<div class="stat" id="proInsightsCard" style="display:none">
<div class="k">Pro Insights (HL/SL/C/SR/HR)</div>
<div class="row" style="justify-content:space-between;gap:10px;margin-top:6px">
<div class="badge" id="mostMissedZoneBadge"></div>
<div class="badge" id="secondShotBadge"></div>
</div>

<div class="bars" id="zoneBars"></div>
<div class="s" id="proInsightsSub">Only counts Pro-mode rounds (zone data).</div>
</div>

<div class="divider"></div>

<div class="small">
Rule: reduce your <b>most missed direction/zone</b> first ‚Äî fastest gains.
</div>
</div>
</div>

<!-- SAVED ROUNDS -->
<div class="card" style="margin-top:12px">
<div class="row" style="justify-content:space-between">
<div>
<div style="font-weight:950;font-size:16px">Saved Rounds</div>
<div class="small" id="countLine">0 total</div>
</div>
</div>

<div class="divider"></div>

<div class="filters" style="grid-template-columns: 1fr 1fr 1fr 1fr;">
<div>
<label>Show</label>
<select id="savedRange">
<option value="today">Today</option>
<option value="day">A specific day‚Ä¶</option>
<option value="all">All rounds</option>
</select>
</div>

<div>
<label>Date</label>
<input id="savedDate" type="date" disabled />
</div>

<div>
<label>Club</label>
<select id="savedClub">
<option value="all">All clubs</option>
</select>
</div>

<div>
<label>Field</label>
<select id="savedField">
<option value="all">All fields</option>
</select>
</div>
</div>

<div class="divider"></div>

<div class="list" id="list"></div>
<div id="empty" class="small" style="display:none;margin-top:10px">No rounds found for these filters.</div>
</div>

<p class="small" style="margin:14px 2px 28px">
Tip: For PDF export on iPhone, tap ‚ÄúPDF‚Äù ‚Üí Print ‚Üí pinch-out preview ‚Üí Share ‚Üí Save to Files (PDF).
</p>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

// ========= Storage + migration =========
const KEY = "trap_tracker_issf_pro_v1_aamr";
const OLD_KEYS = [
"trap_tracker_live_issf_v3_aamr",
"trap_tracker_live_issf_v2",
"trap_tracker_live_issf_v1",
"trap_tracker_live_issf"
];

const $ = (id) => document.getElementById(id);

const ZONES5 = ["HL","SL","C","SR","HR"];

const pct = (a,b)=> b? Math.round((a/b)*1000)/10 : 0;

function todayISO(){
const d = new Date();
const yyyy = d.getFullYear();
const mm = String(d.getMonth()+1).padStart(2,"0");
const dd = String(d.getDate()).padStart(2,"0");
return `${yyyy}-${mm}-${dd}`;
}
$("date").value = todayISO();
$("savedDate").value = todayISO();

function uid(){
return `${Date.now().toString(36)}-${Math.random().toString(36).slice(2,9)}`;
}

function escapeHtml(s){
return String(s).replace(/[&<>'"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;',"\"":'&quot;',"'":'&#39;'}[c]));
}

function loadAny(){
// First try current key
try{
const raw = localStorage.getItem(KEY);
if(raw){
const list = JSON.parse(raw);
if(Array.isArray(list)) return list;
}
}catch{}

// Try old keys (and migrate)
for(const k of OLD_KEYS){
try{
const raw = localStorage.getItem(k);
if(!raw) continue;
const list = JSON.parse(raw);
if(!Array.isArray(list)) continue;

// Migrate old rounds format if needed
const migrated = list.map(r => migrateRound(r)).filter(Boolean);
localStorage.setItem(KEY, JSON.stringify(migrated));
return migrated;
}catch{}
}
return [];
}

function save(list){ localStorage.setItem(KEY, JSON.stringify(list)); }

function parseISODate(iso){
const [y,m,dd] = (iso||"").split("-").map(Number);
if(!y||!m||!dd) return null;
const x = new Date(y, m-1, dd);
x.setHours(0,0,0,0);
return x;
}
function monthKey(d){
return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`;
}
function monthLabel(key){
const [y,m] = key.split("-").map(Number);
const names = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
return `${names[m-1]} ${y}`;
}

function startOfWeek(d){
const x = new Date(d);
const day = (x.getDay() + 6) % 7; // Monday = 0
x.setDate(x.getDate() - day);
x.setHours(0,0,0,0);
return x;
}
function startOfMonth(d){
const x = new Date(d.getFullYear(), d.getMonth(), 1);
x.setHours(0,0,0,0);
return x;
}
function startOfYear(d){
const x = new Date(d.getFullYear(), 0, 1);
x.setHours(0,0,0,0);
return x;
}
function addMonths(d, n){
const x = new Date(d);
x.setMonth(x.getMonth() + n);
return x;
}

// ========= Data model =========
// shotObj = { outcome: "hit"|"miss", zone: "HL"|"SL"|"C"|"SR"|"HR"|"L"|"R"|"UNK", shot: 1|2 }
// round = { id, date, club, field, notes, mode: "simple"|"pro", shots: [shotObj x25], hit, ml, mc, mr, createdAt }

function normalizeShotObj(s){
if(!s || typeof s !== "object") return null;
const outcome = s.outcome === "hit" ? "hit" : "miss";
const zone = typeof s.zone === "string" ? s.zone : "UNK";
const shot = (s.shot === 2) ? 2 : 1;
return { outcome, zone, shot };
}

function roundCountsFromShots(shots){
// Keep "simple view" counts (Hit, Miss Left, Miss Center, Miss Right)
let hit=0, ml=0, mc=0, mr=0;
for(const s of shots){
if(!s) continue;
if(s.outcome === "hit") hit++;
else {
const z = s.zone;
if(z === "HL" || z === "SL" || z === "L") ml++;
else if(z === "HR" || z === "SR" || z === "R") mr++;
else mc++;
}
}
return { shots: 25, hit, ml, mc, mr };
}

function migrateRound(r){
// already new format?
if(r && Array.isArray(r.shots)){
const shots = r.shots.map(normalizeShotObj).filter(Boolean).slice(0,25);
while(shots.length < 25) shots.push({outcome:"hit", zone:"UNK", shot:1}); // safe fill
const c = roundCountsFromShots(shots);
return {
id: r.id || uid(),
date: r.date || todayISO(),
club: (r.club||"").trim(),
field: (r.field||"").trim(),
notes: r.notes || "",
mode: r.mode === "pro" ? "pro" : "simple",
shots,
...c,
createdAt: r.createdAt || Date.now()
};
}

// old formats: liveShots: ['H','L','C','R'] or counts
if(r && Array.isArray(r.liveShots)){
const shots = r.liveShots.slice(0,25).map(code=>{
if(code === "H") return { outcome:"hit", zone:"UNK", shot:1 };
if(code === "L") return { outcome:"miss", zone:"L", shot:1 };
if(code === "R") return { outcome:"miss", zone:"R", shot:1 };
return { outcome:"miss", zone:"C", shot:1 };
});
while(shots.length < 25) shots.push({ outcome:"hit", zone:"UNK", shot:1 });
const c = roundCountsFromShots(shots);
return {
id: r.id || uid(),
date: r.date || todayISO(),
club: (r.club||"").trim(),
field: (r.field||"").trim(),
notes: r.notes || "",
mode: "simple",
shots,
...c,
createdAt: r.createdAt || Date.now()
};
}

// fallback if only counts exist
if(r && typeof r.hit === "number"){
const shots = Array.from({length:25}, (_,i)=> i < r.hit ? ({outcome:"hit", zone:"UNK", shot:1}) : ({outcome:"miss", zone:"C", shot:1}));
const c = roundCountsFromShots(shots);
return {
id: r.id || uid(),
date: r.date || todayISO(),
club: (r.club||"").trim(),
field: (r.field||"").trim(),
notes: r.notes || "",
mode: "simple",
shots,
...c,
createdAt: r.createdAt || Date.now()
};
}

return null;
}

// ========= Live state =========
let rounds = loadAny();

let mode = "simple"; // "simple" | "pro"
let liveShots = []; // array of shotObj
let proOutcome = "hit"; // "hit" | "miss"
let currentShotNum = 1; // 1 | 2

function setMode(m){
mode = m;
$("modeSimpleBtn").classList.toggle("active", mode === "simple");
$("modeProBtn").classList.toggle("active", mode === "pro");
$("simpleControls").style.display = (mode === "simple") ? "" : "none";
$("proControls").style.display = (mode === "pro") ? "" : "none";

$("shotSeg").style.display = (mode === "pro") ? "" : "none";
$("modeHint").textContent = (mode === "simple")
? "Simple: HIT / MISS L / MISS C / MISS R."
: "Pro: choose HIT or MISS, choose 1st/2nd shot, then tap zone HL/SL/C/SR/HR.";

renderProOutcomeUI();
renderLive();
}

function setShotNum(n){
currentShotNum = (n === 2) ? 2 : 1;
$("shot1Btn").classList.toggle("active", currentShotNum === 1);
$("shot2Btn").classList.toggle("active", currentShotNum === 2);
}

function setProOutcome(o){
proOutcome = (o === "miss") ? "miss" : "hit";
renderProOutcomeUI();
}

function renderProOutcomeUI(){
$("proHitBtn").classList.toggle("active", proOutcome === "hit");
$("proMissBtn").classList.toggle("active", proOutcome === "miss");
$("hitDiagramCard").classList.toggle("dim", proOutcome !== "hit");
$("missDiagramCard").classList.toggle("dim", proOutcome !== "miss");
}

function stationIndexFromShotIndex(i){
return Math.min(4, Math.floor(i/5));
}

function renderLive(){
const idx = liveShots.length;
const station = stationIndexFromShotIndex(Math.max(0, idx)) + 1;

const c = roundCountsFromShots(liveShots);
const hit = c.hit;

$("stationV").textContent = `${Math.min(5, station)}/5`;
$("shotV").textContent = `${idx}/25`;
$("scoreV").textContent = `${hit}/25`;
$("hitPctV").textContent = `${pct(hit, Math.max(1, idx))}%`;

if(idx === 0) $("statusLine").textContent = "Ready. Log 25 targets.";
else if(idx < 25) $("statusLine").textContent = `Live‚Ä¶ Station ${Math.min(5, station)} ‚Ä¢ Target ${idx+1}/25`;
else $("statusLine").textContent = "Round complete. Save it or reset.";

const done = idx >= 25;
$("undoBtn").disabled = (idx === 0);

// Simple buttons
$("tapHit").disabled = done;
$("tapLeft").disabled = done;
$("tapCenter").disabled = done;
$("tapRight").disabled = done;

// Pro outcome + diagrams
$("proHitBtn").disabled = done;
$("proMissBtn").disabled = done;

// Render shot grid
const grid = $("shotGrid");
grid.innerHTML = "";
for(let i=0;i<25;i++){
const s = liveShots[i];
const st = Math.floor(i/5) + 1;
const inSt = (i % 5) + 1;

const el = document.createElement("div");
if(!s){
el.className = "shot pending";
el.innerHTML = `<div class="tiny">‚Äî</div><div class="meta">S${st} ‚Ä¢ #${inSt}</div>`;
} else {
const isHit = s.outcome === "hit";
el.className = "shot " + (isHit ? "hit" : "miss");

const zoneLabel = (s.zone || "UNK");
const shotLabel = (s.shot === 2) ? "2" : "1";
const icon = isHit ? "‚úÖ" : "‚ùå";
el.innerHTML = `<div class="tiny">${icon} ${zoneLabel} ‚Ä¢ ${shotLabel}</div><div class="meta">S${st} ‚Ä¢ #${inSt}</div>`;
}
grid.appendChild(el);
}
}

function pushShotObj(obj){
if(liveShots.length >= 25) return;
liveShots.push(obj);
renderLive();
}

// ========= Simple mode buttons =========
function pushSimple(code){
if(liveShots.length >= 25) return;
if(code === "H"){
pushShotObj({ outcome:"hit", zone:"UNK", shot:1 });
} else if(code === "L"){
pushShotObj({ outcome:"miss", zone:"L", shot:1 });
} else if(code === "R"){
pushShotObj({ outcome:"miss", zone:"R", shot:1 });
} else {
pushShotObj({ outcome:"miss", zone:"C", shot:1 });
}
}

$("tapHit").addEventListener("click", ()=>pushSimple("H"));
$("tapLeft").addEventListener("click", ()=>pushSimple("L"));
$("tapCenter").addEventListener("click", ()=>pushSimple("C"));
$("tapRight").addEventListener("click", ()=>pushSimple("R"));

// ========= Pro mode interactions =========
$("proHitBtn").addEventListener("click", ()=>setProOutcome("hit"));
$("proMissBtn").addEventListener("click", ()=>setProOutcome("miss"));

// clicking zones on diagrams records immediately
// FIX: only allow tapping the ACTIVE diagram (matches proOutcome)
// FIX: SVG tap reliability handled by CSS: .zone * { pointer-events:none }
function bindDiagram(diagramEl, forcedOutcome){
diagramEl.querySelectorAll(".zone").forEach(g=>{
g.addEventListener("click", ()=>{
if(liveShots.length >= 25) return;
if(mode !== "pro") return;
if(forcedOutcome !== proOutcome) return; // important: only active diagram
const z = g.getAttribute("data-zone");
pushShotObj({ outcome: forcedOutcome, zone: z, shot: currentShotNum });
});
});
}
bindDiagram($("hitDiagram"), "hit");
bindDiagram($("missDiagram"), "miss");

// ========= Controls =========
$("undoBtn").addEventListener("click", ()=>{
liveShots.pop();
renderLive();
});

$("resetRoundBtn").addEventListener("click", ()=>{
liveShots = [];
renderLive();
});

$("modeSimpleBtn").addEventListener("click", ()=>setMode("simple"));
$("modeProBtn").addEventListener("click", ()=>setMode("pro"));
$("shot1Btn").addEventListener("click", ()=>setShotNum(1));
$("shot2Btn").addEventListener("click", ()=>setShotNum(2));

$("saveRoundBtn").addEventListener("click", ()=>{
if(liveShots.length !== 25){
$("statusLine").textContent = `You are at ${liveShots.length}/25. Finish the round to save.`;
return;
}
const c = roundCountsFromShots(liveShots);

rounds.unshift({
id: uid(),
date: $("date").value || todayISO(),
club: $("club").value.trim(),
field: $("field").value.trim(),
notes: $("notes").value || "",
mode,
shots: liveShots.slice(0,25).map(normalizeShotObj).filter(Boolean),
...c,
createdAt: Date.now()
});

save(rounds);

liveShots = [];
$("notes").value = "";
renderAll();
});

// ========= Dropdowns + filters =========
function unique(list){
return Array.from(new Set(list.filter(Boolean)));
}

function rebuildDropdowns(){
const clubs = unique(rounds.map(r => (r.club||"").trim())).sort((a,b)=>a.localeCompare(b));
const fields = unique(rounds.map(r => (r.field||"").trim())).sort((a,b)=>a.localeCompare(b));

// Overview selectors
const clubSel = $("clubSel");
const fieldSel = $("fieldSel");
const keepClub = clubSel.value || "all";
const keepField = fieldSel.value || "all";

clubSel.innerHTML = `<option value="all">All clubs</option>` + clubs.map(c=>`<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join("");
fieldSel.innerHTML = `<option value="all">All fields</option>` + fields.map(f=>`<option value="${escapeHtml(f)}">${escapeHtml(f)}</option>`).join("");

clubSel.value = clubs.includes(keepClub) ? keepClub : "all";
fieldSel.value = fields.includes(keepField) ? keepField : "all";

// Saved selectors
const savedClub = $("savedClub");
const savedField = $("savedField");
const keepSC = savedClub.value || "all";
const keepSF = savedField.value || "all";

savedClub.innerHTML = `<option value="all">All clubs</option>` + clubs.map(c=>`<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join("");
savedField.innerHTML = `<option value="all">All fields</option>` + fields.map(f=>`<option value="${escapeHtml(f)}">${escapeHtml(f)}</option>`).join("");

savedClub.value = clubs.includes(keepSC) ? keepSC : "all";
savedField.value = fields.includes(keepSF) ? keepSF : "all";

// Month dropdown
const monthSel = $("monthSel");
const monthKeys = unique(rounds.map(r => {
const d = parseISODate(r.date);
return d ? monthKey(d) : "";
})).sort((a,b)=> (a>b ? -1 : 1)); // newest first

const keepMonth = monthSel.value || "";
monthSel.innerHTML = `<option value="">Select month‚Ä¶</option>` + monthKeys.map(k=>`<option value="${k}">${monthLabel(k)}</option>`).join("");
monthSel.value = monthKeys.includes(keepMonth) ? keepMonth : "";
}

function filterByMeta(list, clubVal, fieldVal){
const c = clubVal || "all";
const f = fieldVal || "all";
return list.filter(r => {
const okC = (c==="all") || ((r.club||"").trim() === c);
const okF = (f==="all") || ((r.field||"").trim() === f);
return okC && okF;
});
}

function filterByRange(list){
const now = new Date(); now.setHours(0,0,0,0);
const range = $("rangeSel").value;
const monthPick = $("monthSel").value;

let start = null, end = null; // [start, end)
if(range === "all"){
start = null; end = null;
} else if(range === "today"){
start = new Date(now);
end = new Date(now); end.setDate(end.getDate()+1);
} else if(range === "week"){
start = startOfWeek(now);
end = new Date(start); end.setDate(end.getDate()+7);
} else if(range === "month"){
start = startOfMonth(now);
end = addMonths(start, 1);
} else if(range === "last3"){
end = addMonths(startOfMonth(now), 1);
start = addMonths(end, -3);
} else if(range === "last6"){
end = addMonths(startOfMonth(now), 1);
start = addMonths(end, -6);
} else if(range === "year"){
start = startOfYear(now);
end = new Date(now.getFullYear()+1, 0, 1);
} else if(range === "monthPick"){
if(!monthPick) return [];
const [y,m] = monthPick.split("-").map(Number);
start = new Date(y, m-1, 1); start.setHours(0,0,0,0);
end = new Date(y, m, 1); end.setHours(0,0,0,0);
}

return list.filter(r=>{
const d = parseISODate(r.date);
if(!d) return false;
if(!start && !end) return true;
return (d >= start && d < end);
});
}

function tier(score){
if(score >= 20) return "good";
if(score >= 18) return "mid";
return "low";
}

// ========= Overview =========
function renderOverview(){
const isMonthPick = $("rangeSel").value === "monthPick";
$("monthSel").disabled = !isMonthPick;

let list = rounds.slice();
list = filterByMeta(list, $("clubSel").value, $("fieldSel").value);
list = filterByRange(list);

$("rangeCount").textContent = `${list.length} rounds`;

// subtitle label
const r = $("rangeSel").value;
const label =
r==="today" ? "Today" :
r==="week" ? "This week" :
r==="month" ? "This month" :
r==="last3" ? "Last 3 months" :
r==="last6" ? "Last 6 months" :
r==="year" ? "This year" :
r==="all" ? "All time" :
r==="monthPick" ? ( $("monthSel").value ? monthLabel($("monthSel").value) : "Past month" ) :
"Selected period";
$("overviewSubtitle").textContent = `Stats for: ${label}`;

if(list.length === 0){
$("avgHits").textContent = "0.0/25";
$("avgHitsSub").textContent = "Avg hit %: 0%";
$("bestWorst").textContent = "‚Äî";
$("last10").textContent = "‚Äî";
$("last10Sub").textContent = "Avg hits (if ‚â•10)";
$("avgML").textContent = "0.0";
$("avgMC").textContent = "0.0";
$("avgMR").textContent = "0.0";
$("missDiagramSub").textContent = "Based on selected period";
$("mostMissedBadge").style.display = "none";
$("insightBadge").style.display = "none";
$("proInsightsCard").style.display = "none";
return;
}

const totalHit = list.reduce((s,r)=>s+(r.hit||0),0);
const totalL = list.reduce((s,r)=>s+(r.ml||0),0);
const totalC = list.reduce((s,r)=>s+(r.mc||0),0);
const totalR = list.reduce((s,r)=>s+(r.mr||0),0);

const avgHits = totalHit / list.length;
const avgPct = pct(totalHit, list.length*25);

$("avgHits").textContent = `${avgHits.toFixed(1)}/25`;
$("avgHitsSub").textContent = `Avg hit %: ${avgPct}%`;

const scores = list.map(r=> (r.hit||0));
const best = Math.max(...scores);
const worst = Math.min(...scores);

const bestStar = best >= 23 ? " ‚≠ê" : "";
$("bestWorst").innerHTML = `
<span class="pillScore ${tier(best)}">Best: ${best}/25${bestStar}</span>
<span class="pillScore ${tier(worst)}">Worst: ${worst}/25</span>
`;

const byRecent = list.slice().sort((a,b)=>(b.createdAt||0)-(a.createdAt||0));
const last10List = byRecent.slice(0,10);
if(last10List.length >= 10){
const last10Avg = last10List.reduce((s,r)=>s+(r.hit||0),0) / last10List.length;
$("last10").textContent = `${last10Avg.toFixed(1)}/25`;
$("last10Sub").textContent = `Average of last 10 rounds`;
} else {
$("last10").textContent = "‚Äî";
$("last10Sub").textContent = `Need 10 rounds (you have ${last10List.length})`;
}

const avgML = totalL / list.length;
const avgMC = totalC / list.length;
const avgMR = totalR / list.length;
$("avgML").textContent = avgML.toFixed(1);
$("avgMC").textContent = avgMC.toFixed(1);
$("avgMR").textContent = avgMR.toFixed(1);
$("missDiagramSub").textContent = `Avg misses per round (selected period)`;

// most missed (simple view)
const missArr = [
{k:"LEFT", v: totalL, dot:"var(--red)"},
{k:"CENTER", v: totalC, dot:"var(--orange)"},
{k:"RIGHT", v: totalR, dot:"var(--yellow)"},
].sort((a,b)=>b.v-a.v);
const top = missArr[0];

const badge = $("mostMissedBadge");
badge.style.display = "inline-flex";
badge.innerHTML = `<span class="dot" style="background:${top.dot}"></span> Most missed: <strong>${top.k}</strong> (${top.v})`;

const insight = $("insightBadge");
insight.style.display = "inline-flex";
let text = "";
if(top.k === "CENTER") text = "Focus: timing + trigger discipline";
if(top.k === "LEFT") text = "Focus: line & first move to LEFT";
if(top.k === "RIGHT") text = "Focus: keep moving through RIGHT";
insight.innerHTML = `üéØ ${text}`;

// ---- Pro Insights (only pro rounds with zone data) ----
const proRounds = list.filter(r => r.mode === "pro" && Array.isArray(r.shots) && r.shots.length === 25);
if(proRounds.length === 0){
$("proInsightsCard").style.display = "none";
return;
}

// aggregate zone misses/hits, and 2nd shot usage
const zoneStats = {};
for(const z of ZONES5) zoneStats[z] = { hit:0, miss:0 };

let secondShotCount = 0;
let totalShots = 0;

for(const rd of proRounds){
for(const s of rd.shots){
if(!s) continue;
if(s.shot === 2) secondShotCount++;
totalShots++;
const z = ZONES5.includes(s.zone) ? s.zone : "C";
if(s.outcome === "hit") zoneStats[z].hit++;
else zoneStats[z].miss++;
}
}

// most missed zone
const zoneMissArr = ZONES5.map(z => ({ z, v: zoneStats[z].miss })).sort((a,b)=>b.v-a.v);
const topZone = zoneMissArr[0];

$("proInsightsCard").style.display = "";
$("mostMissedZoneBadge").innerHTML = `üî• Most missed zone: <strong>${topZone.z}</strong> (${topZone.v})`;
const secondShotRate = totalShots ? (secondShotCount / totalShots) : 0;
$("secondShotBadge").innerHTML = `üéØ 2nd shot usage: <strong>${Math.round(secondShotRate*100)}%</strong>`;

// bars: hit% per zone (from pro data)
const bars = $("zoneBars");
bars.innerHTML = "";
for(const z of ZONES5){
const h = zoneStats[z].hit;
const m = zoneStats[z].miss;
const tot = h + m;
const hp = tot ? Math.round((h/tot)*100) : 0;

const row = document.createElement("div");
row.className = "barRow";
row.innerHTML = `
<div class="small" style="font-weight:950">${z}</div>
<div class="barTrack"><div class="barFill" style="width:${hp}%; background:var(--green)"></div></div>
<div class="small" style="text-align:right">${hp}%</div>
`;
bars.appendChild(row);
}

// pro subtitle
$("proInsightsSub").textContent = `Based on ${proRounds.length} Pro rounds in this period.`;
}

// ========= Saved rounds + PDF export =========
function renderSaved(){
let list = rounds.slice();

const mode = $("savedRange").value;
const today = todayISO();
if(mode === "today"){
list = list.filter(r => (r.date||"") === today);
$("savedDate").disabled = true;
} else if(mode === "day"){
$("savedDate").disabled = false;
const d = $("savedDate").value || today;
list = list.filter(r => (r.date||"") === d);
} else {
$("savedDate").disabled = true;
}

list = filterByMeta(list, $("savedClub").value, $("savedField").value);
list.sort((a,b)=>(b.createdAt||0)-(a.createdAt||0));

$("countLine").textContent = `${rounds.length} total ‚Ä¢ ${list.length} shown`;

const container = $("list");
container.innerHTML = "";
$("empty").style.display = list.length ? "none" : "block";

for(const r of list){
const miss = (r.ml||0)+(r.mc||0)+(r.mr||0);
const club = (r.club||"").trim();
const field = (r.field||"").trim();
const place = [club, field].filter(Boolean).join(" ‚Ä¢ ");
const modeLabel = r.mode === "pro" ? "PRO" : "SIMPLE";

// small preview 25 cells
const shotsArr = Array.isArray(r.shots) ? r.shots : [];
const preview = shotsArr.slice(0,25).map((s)=>{
const isHit = s && s.outcome === "hit";
const icon = isHit ? "‚úì" : "√ó";
const z = s ? (s.zone || "UNK") : "‚Äî";
const n = s ? ((s.shot===2) ? "2" : "1") : "";
const color = isHit ? "rgba(34,197,94,.10)" : "rgba(239,68,68,.08)";
const border = isHit ? "rgba(34,197,94,.28)" : "rgba(239,68,68,.22)";
const txt = isHit ? "var(--green)" : "var(--red)";
return `<span style="
display:inline-flex;flex-direction:column;align-items:center;justify-content:center;
width:24px;height:24px;border-radius:8px;border:1px solid ${border};
margin:2px;font-weight:950;font-size:10px;background:${color};color:${txt};
line-height:1.05
">${icon}<span style="font-size:9px;color:var(--muted);font-weight:900">${z}${r.mode==='pro' ? "‚Ä¢"+n : ""}</span></span>`;
}).join("");

const el = document.createElement("div");
el.className = "round";
el.innerHTML = `
<div class="roundHead">
<div style="min-width:0">
<div style="font-weight:950">
${escapeHtml(r.date || "")}
<span class="meta2">${place ? "‚Ä¢ "+escapeHtml(place) : ""}</span>
<span class="meta2">‚Ä¢ ${modeLabel}</span>
</div>
<div class="meta2">Score: <b>${r.hit}/25</b> ‚Ä¢ Hit ${pct(r.hit,25)}% ‚Ä¢ Miss ${pct(miss,25)}%</div>
</div>
<div class="row" style="gap:8px;justify-content:flex-end">
<button class="btn mini" data-pdf="${r.id}" type="button">PDF</button>
<button class="btn mini danger" data-del="${r.id}" type="button">Delete</button>
</div>
</div>

<div style="padding:10px 12px;border-bottom:1px solid var(--border)">
<div class="small" style="margin-bottom:6px">Pattern (25 targets)</div>
<div style="display:flex;flex-wrap:wrap;gap:0">${preview || "<span class='small'>No pattern saved.</span>"}</div>
</div>

<div class="mini">
<div class="box g"><div class="k">Hit</div><div class="v" style="color:var(--green)">${r.hit}</div></div>
<div class="box
